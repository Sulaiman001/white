var list="inbox",loadKey=list,connected=!1,reConnecting=!1,room="",username="",conn=null,autolinker=new Autolinker({stripPrefix:!1,newWindow:!0}),prevtime=new Date,curval,t,p=function(a){},removeTitle=function(){return"Remove item"},strikeTitle=function(){return"Strike out item"},escapeHtml=function(a){a=autolinker.link(jQuery("<div/>").text(a).html());a=a.replace(/@&lt;(.*?)&gt;/,'<span class="label label-remind">$1</span>');a=a.replace(/@\((.*?)\)/,'<span class="label label-remind">$1</span>');
a=a.replace(/([0-9]{1,2}:[0-9]{1,2} [0-9]{1,2}\/[0-9]{1,2}\/[0-9]{4})/,'<span class="label label-remind">$1</span>');a=a.replace(/([^\\])?(#bug)/g,'$1<span class="label label-bug">$2</span>');a=a.replace(/([^\\])?(#feature)/g,'$1<span class="label label-feature">$2</span>');a=a.replace(/([^\\])?(#improvement)/g,'$1<span class="label label-improvement">$2</span>');a=a.replace(/([^\\])?(#enhancement)/g,'$1<span class="label label-enhancement">$2</span>');a=a.replace(/([^\\])?(#[a-zA-Z0-9-_]+)/g,'$1<span class="label label-label">$2</span>');
return a=a.replace(/([^\\])?(![0-9]+)/,'$1<span class="label label-priority">$2</span>')},escapeApos=function(a){return null===list||""===list||void 0===a?a:a.replace(/'/,"\\'")},escapeQuotes=function(a){return null===list||""===list||void 0===a?a:a.replace(/"/,'\\"')},moveListItemToTop=function(a){a=$(".wt-all-list-item[data-list='"+escapeApos(a)+"']").parent();a.fadeTo(500,0);a.detach();$(".search-input-list-item").after(a);a.fadeTo(500,1)},buildDoneCheckbox=function(a){return'<span data-id="'+
a+'" class="wt-list-item-chk-done btn-tooltip glyphicon glyphicon-trash" id="wt-list-item-chk-done-'+a+'" title="'+removeTitle()+'">&nbsp;</span>'},buildStrikeCheckbox=function(a){return'<input type="checkbox" data-id="'+a+'" class="wt-list-item-chk-strike btn-tooltip" id="wt-list-item-chk-strike-'+a+'" title="'+strikeTitle()+'" />'},saveText=function(a,c,b){$.ajax({type:"POST",url:"services/save/"+encodeURIComponent(list)+"/"+a+"/"+b+"/"+encodeURIComponent(getHashVar(3)),data:{text:c},dataType:"json",
success:function(b){moveListItemToTop(list);localStorage.removeItem(loadKey);if(null===a){var e=new Markon;$("#wt-list-item-0").after('<div id="wt-list-item-'+b.id+'" class="wt-list-item" data-id="'+b.id+'"><p class="wt-list-item-text">'+buildDoneCheckbox(b.id)+" "+buildStrikeCheckbox(b.id)+' <span id="wt-text-'+b.id+'" class="wt-text" data-id="'+b.id+'">'+e.render(escapeHtml(c))+"</span></p></div>");useWebSockets&&conn.send(JSON.stringify({a:"message",actiontype:"add",list:list,text:c,id:b.id}));
applyEditItem(b.id);applyRemoveItem(b.id);applyStrikeItem(b.id);applySaveTextOfItem(b.id);applySaveOnEnter(b.id);applyTooltip()}else useWebSockets&&conn.send(JSON.stringify({a:"message",actiontype:"save",list:list,text:c,id:b.id}))}})},addStrikeHeader=function(a){a&&0<$(".wt-strikes-header").size()&&$(".wt-strikes-header").remove();0<$(".wt-strike").size()?0===$(".wt-strikes-header").size()&&$(".wt-strike:first").parent().parent().before('<h1 class="wt-strikes-header">These items are marked done</h1>'):
0<$(".wt-strikes-header").size()&&$(".wt-strikes-header").remove()},editing=!1,applyEditItem=function(a){$(".wt-text a").on("click",function(){if(!a)var a=window.event;a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation()});$("#wt-text-"+a).on("click",function(){editing=!0;var a=$(this).data("id");new Markon;var b=getHashVar(2);loadItem(a,b,function(b){b=b.text;$("#wt-list-item-"+a).html('<input class="wt-list-item-input" type="text" id="wt-list-item-input-'+a+'" data-id="'+a+'" placeholder="Enter new item here" />');
$("#wt-list-item-input-"+a).val(b);$("#wt-list-item-input-"+a).focus();applySaveTextOfItem(a);applySaveOnEnter(a);applyTooltip()})})},applyRemoveItem=function(a){$("#wt-list-item-chk-done-"+a).on("click",function(){if(confirm("Confirm delete please")){var a=$(this).data("id");$.getJSON("services/delete/"+a+"/"+encodeURIComponent(getHashVar(3)),function(b){moveListItemToTop(list);localStorage.removeItem(loadKey);$("#wt-list-item-"+a).remove();addStrikeHeader();useWebSockets&&conn.send(JSON.stringify({a:"message",
actiontype:"remove",list:list,id:a}))})}})},applyStrikeItem=function(a){$("#wt-list-item-chk-strike-"+a).on("click",function(){var a=$(this).data("id"),b=$("#wt-text-"+a),d=!1;b.hasClass("wt-strike")||(d=!0);$("#wt-list-item-chk-strike-"+a);d?b.addClass("wt-strike"):b.removeClass("wt-strike");$.getJSON("services/strike/"+a+"/"+d+"/"+encodeURIComponent(getHashVar(3)),function(b){moveListItemToTop(list);localStorage.removeItem(loadKey);b=$("#wt-list-item-"+a);d?$(".wt-list-item:last").after(b):0<$(".wt-strike").size()&&
$(".wt-strike:first").parent().parent().before(b);addStrikeHeader(!0);useWebSockets&&conn.send(JSON.stringify({a:"message",actiontype:"strike",list:list,strike:d,id:a}))}).fail(function(){d?b.removeClass("wt-strike"):b.addClass("wt-strike")})})},applySaveTextOfItem=function(a){prevtime=parseInt((new Date).getTime());curval="";t=null;$(document).on("keyup","#wt-list-item-input-"+a,function(){var a=$(this).data("id");if(0!==a&&(curtime=parseInt((new Date).getTime()),next=prevtime+500,prevtime=curtime,
curtime<next)){clearTimeout(t);var b=$("#wt-list-item-input-"+a).val(),b=b.replace(/'/,"\\'");t=setTimeout("saveText('"+a+"', '"+b+"', 'false')",500)}})},doApplySaveOnEnter=function(a,c){if(editing||$("#wt-list-item-input-0").is(":focus")){editing=!1;c.preventDefault();var b=a.data("id"),d=$("#wt-list-item-input-"+b).val();if(0===b)saveText(null,d,!0);else{var e=new Markon;$("#wt-list-item-"+b).html('<p class="wt-list-item-text">'+buildDoneCheckbox(b)+" "+buildStrikeCheckbox(b)+' <span id="wt-text-'+
b+'" class="wt-text" data-id="'+b+'">'+e.render(escapeHtml(d))+"</span></p>");applyEditItem(b);applyRemoveItem(b);applyStrikeItem(b);applySaveTextOfItem(b);applySaveOnEnter(b);applyTooltip();saveText(b,d,!0)}a.val("")}},applySaveOnEnter=function(a){$("#wt-list-item-input-"+a).keypress(function(a){var b=$(this);b.on("blur",function(){doApplySaveOnEnter(b,a)});13!==a.which&&27!==a.which||doApplySaveOnEnter(b,a)})},applyAllListClick=function(){$(".wt-all-list-item").on("click",function(){window.location.hash=
"#/list/"+$(this).data("list")+"/"+getHashVar(2)})},applyTooltip=function(){/iPhone|iPod|iPad|Android|BlackBerry|phone/i.test(navigator.userAgent)||$(".btn-tooltip").tooltip()},menuToggle=function(){$(".menu-toggle").unbind("click");$(".menu-toggle").on("click",function(a){a.preventDefault();a=$("#wrapper");a.hasClass("toggled")?a.removeClass("toggled"):a.addClass("toggled")})},hideSideBar=function(){$("#wrapper").removeClass("toggled")},setListsLink=function(a){$(".lists-link").attr("href","#/lists/"+
encodeURIComponent(a))},init=function(){var a=window.location.hash,a=a.replace(/^#/,""),a=a.split("/");startConnection();switch(a[1]){case "list":list=a[2];loadKey="list-"+list;load(list);seedSideBar(a[3]);setListsLink(a[3]);setPlaceholder(list);break;case "lists":loadAll();seedSideBar(a[2]);setListsLink(a[2]);break;default:window.location.hash="#/list/inbox/"+a[1]}menuToggle()},isUndefined=function(a){return void 0===a},getHashVar=function(a){return window.location.hash.replace(/^#/,"").split("/")[a]},
loadAll=function(){$("#wt-list-item-0").hide();$(".wt-list-item").remove();$("title").text("all lists");$.getJSON("services/load-all/"+encodeURIComponent(getHashVar(2)),function(a){var c=$(a.items).size(),b=Math.floor(c/4),d=c-3*b,e=$(".wt-list");4<=c?(e.append("<div class='row'><div class='col-sm-12 col-md-6 col-lg-3' id='list-col-1'></div><div class='col-sm-12 col-md-6 col-lg-3' id='list-col-2'></div><div class='col-sm-12 col-md-6 col-lg-3' id='list-col-3'></div><div class='col-sm-12 col-md-6 col-lg-3' id='list-col-4'></div></div>"),
$.each(a.items,function(a,c){var e=a+1;(e<=d?$("#list-col-1"):e>d&&e<=d+1*b?$("#list-col-2"):e>d+1*b&&e<=d+2*b?$("#list-col-3"):$("#list-col-4")).append('<div class="wt-all-list-item" data-list="'+escapeHtml(c)+'"><a title="#'+escapeHtml(c)+'" href="#/list/'+escapeHtml(c)+"/"+getHashVar(2)+'">#'+escapeHtml(c)+"</a></div>")}),e.append("</div>")):(e.append("<div class='row'><div class='columns small-12 medium-12 large-12' id='list-col-1'></div></div>"),$.each(a.items,function(a,b){$("#list-col-1").append('<div class="wt-all-list-item" data-list="'+
escapeHtml(b)+'"><a title="#'+escapeHtml(b)+'" href="#/list/'+escapeHtml(b)+"/"+getHashVar(2)+'">#'+escapeHtml(b)+"</a></div>")}));applyAllListClick();addStrikeHeader()})},seedSideBar=function(a){$.getJSON("services/load-all/"+encodeURIComponent(a),function(c){var b=$.map(c.items,function(a,b){return[a]}),d=$.map(c.items,function(a,b){return[a]});d.sort();var e="#960000 #937d00 #b7b100 #108e00 #00438c #590089".split(" "),f=Math.ceil(b.length/e.length);$.each(b,function(b,c){for(var k=0,l="",g=0;g<
d.length;g+=f){0===g/10%f&&(k=0);var q=d.slice(g,g+f);$.each(q,function(a,b){b===c&&(l=" style = 'color:"+e[k]+";' ",console.log("Does '"+b+"' = '"+c+"'? "+l))});k++}$(".sidebar-nav").append('<li class="wt-all-list-item-li"><div class="wt-all-list-item" data-list="'+escapeHtml(c)+'"><a class="wt-all-list-item-a" '+l+' title="#'+escapeHtml(c)+'" href="#/list/'+escapeHtml(c)+"/"+encodeURIComponent(a)+'">#'+escapeHtml(c)+"</a></div></li>")});sortSideBar("list-name","asc")});hideSideBar()},sortSideBar=
function(a,c){var b=$(".wt-all-list-item-li");"list-name"===a&&"asc"===c&&b.sort(function(a,b){var c=$(a).find(".wt-all-list-item-a").text().replace(/^#/,"")||"",h=$(h).find(".wt-all-list-item-a").text().replace(/^#/,"")||"";return c.localeCompare(h)})},escapeDoubleQuotes=function(a){return void 0===a||null===a?a:a.replace(/"/,'\\"')},buildPlaceholder=function(a){return"Add to #"+a},setPlaceholder=function(a){$("#wt-list-item-input-0").attr("placeholder",escapeDoubleQuotes(buildPlaceholder(a)))},
load=function(a){$("#wt-list-item-0").show();$(".wt-list-item").remove();$(".wt-all-list-item").remove();$("title").text("#"+a);var c="list-"+a;if(null!=localStorage.getItem(c)){var b=JSON.parse(localStorage.getItem(c));addListItem(b.items);addStrikeHeader(!0)}else $.getJSON("services/load/"+encodeURIComponent(a)+"/"+encodeURIComponent(getHashVar(3)),function(b){null==localStorage.getItem(c)&&localStorage.setItem(c,JSON.stringify(b));addListItem(b.items);addStrikeHeader(!0);setPlaceholder(a)}).fail(function(){if(null!=
localStorage.getItem(c)){var a=JSON.parse(localStorage.getItem(c));addListItem(a.items);addStrikeHeader(!0)}})},loadItem=function(a,c,b){$.getJSON("services/load/"+encodeURIComponent(c)+"/"+a+"/"+encodeURIComponent(getHashVar(3)),function(d){0<d.items.length?b(d.items[0]):alert("Could not find list item "+a+" for list "+c)}).fail(function(){alert("Could not load list item "+a+" for list "+c)})},search=function(a){$(".wt-list-item").remove();$.getJSON("services/search/"+encodeURIComponent(a)+"/"+encodeURIComponent(getHashVar(3)),
function(a){addListItem(a.items)})},addListItem=function(a){var c=new Markon,b=0;$.each(a,function(a,e){var f=e.id,h=e.text;0===a&&(b=0);var n=e.strike?"wt-strike":"";$("#wt-list-item-"+b).after('<div id="wt-list-item-'+f+'" class="wt-list-item" data-id="'+f+'"><p class="wt-list-item-text">'+buildDoneCheckbox(f)+" "+buildStrikeCheckbox(f)+' <span id="wt-text-'+f+'" class="wt-text '+n+'" data-id="'+f+'">'+c.render(escapeHtml(h))+'</span> <span class="timestamp">'+e.timestamp+"</span></p></div>");applyEditItem(f);
applyRemoveItem(f);applyStrikeItem(f);applyTooltip();b=f})},sortByPriority=function(){},handleMessage=function(a){a=JSON.parse(a);if("message"===a.a&&a.list===list)if("strike"===a.actiontype){var c=$("#wt-text-"+a.id);a.strike?c.addClass("wt-strike"):c.removeClass("wt-strike");$("#wt-list-item-chk-strike-"+a.id).prop("checked",a.strike)}else"remove"===a.actiontype?$("#wt-list-item-"+a.id).remove():"add"===a.actiontype?($("#wt-list-item-0").after('<div id="wt-list-item-'+a.id+'" class="wt-list-item" data-id="'+
a.id+'"><p class="wt-list-item-text">'+buildDoneCheckbox(a.id)+" "+buildStrikeCheckbox(a.id)+' <span id="wt-text-'+a.id+'" class="wt-text" data-id="'+a.id+'">'+a.text+"</span></p></div>"),applyEditItem(a.id),applyRemoveItem(a.id),applyStrikeItem(a.id),applySaveTextOfItem(a.id),applySaveOnEnter(a.id),applyTooltip()):"save"===a.actiontype&&($("#wt-list-item-"+a.id).html('<p class="wt-list-item-text">'+buildDoneCheckbox(a.id)+" "+buildStrikeCheckbox(a.id)+' <span id="wt-text-'+a.id+'" class="wt-text" data-id="'+
a.id+'">'+a.text+"</span></p>"),applyEditItem(a.id),applyRemoveItem(a.id),applyStrikeItem(a.id),applySaveTextOfItem(a.id),applySaveOnEnter(a.id),applyTooltip())},qs=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(location.search);return null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))},startConnection=function(){useWebSockets&&!connected&&(conn=new WebSocket(webSocketUrl),conn.onopen=function(a){connected=!0;reConnecting=!1},conn.onclose=
function(a){connected=!1;reConnecting||reConnect()},conn.onerror=function(a){connected=!1;reConnecting||reConnect()},conn.onmessage=function(a){handleMessage(a.data)})},reConnect=function(){reConnecting=!0;connected||(init(),setTimeout(reConnect,2E3))};function Markon(){}Markon.prototype.render=function(a){return this.mutate(a,[this.code])};Markon.prototype.unRender=function(a){return this.mutate(a,[this.unCode])};Markon.prototype.mutate=function(a,c){var b=a;for(m=0;m<c.length;m++)b=c[m](b);return b};
Markon.prototype.code=function(a){return void 0===a||null===a||0===a.length?a:a.replace(/`(.*?)`/g,"<code>$1</code>")};Markon.prototype.unCode=function(a){return void 0===a||null===a||0===a.length?a:a.replace(/<code>(.*?)<\/code>/g,"`$1`")};
$(document).ready(function(){init();$(window).on("hashchange",function(){init()});$(".wt-list-item-input:first").focus();applySaveTextOfItem(0);applySaveOnEnter(0);hideSideBar();$(".search-button").on("click",function(){search($("#q").val())});$("#q").keypress(function(a){$(this);13!==a.which&&27!==a.which||search($("#q").val())})});
