var list="inbox",loadKey=list,connected=!1,reConnecting=!1,room="",username="",conn=null,autolinker=new Autolinker({stripPrefix:!1,newWindow:!0}),p=function(a){},removeTitle=function(){return"Remove item"},strikeTitle=function(){return"Strike out item"},escapeHtml=function(a){a=autolinker.link(jQuery("<div/>").text(a).html());a=a.replace(/@&lt;(.*?)&gt;/,'<span class="label label-remind">$1</span>');a=a.replace(/@\((.*?)\)/,'<span class="label label-remind">$1</span>');a=a.replace(/([0-9]{1,2}:[0-9]{1,2} [0-9]{1,2}\/[0-9]{1,2}\/[0-9]{4})/,
'<span class="label label-remind">$1</span>');a=a.replace(/([^\\])?(#[a-zA-Z0-9-_]+)/g,'$1<span class="label label-label">$2</span>');return a=a.replace(/([^\\])?(![0-9]+)/,'$1<span class="label label-priority">$2</span>')},escapeApos=function(a){return null===list||""===list||void 0===a?a:a.replace(/'/,"\\'")},escapeQuotes=function(a){return null===list||""===list||void 0===a?a:a.replace(/"/,'\\"')},moveListItemToTop=function(a){a=$(".wt-all-list-item[data-list='"+escapeApos(a)+"']").parent();a.fadeTo(500,
0);a.detach();$(".search-input-list-item").after(a);a.fadeTo(500,1)},buildDoneCheckbox=function(a){return'<span data-id="'+a+'" class="wt-list-item-chk-done btn-tooltip glyphicon glyphicon-trash" id="wt-list-item-chk-done-'+a+'" title="'+removeTitle()+'">&nbsp;</span>'},buildStrikeCheckbox=function(a){return'<input type="checkbox" data-id="'+a+'" class="wt-list-item-chk-strike btn-tooltip" id="wt-list-item-chk-strike-'+a+'" title="'+strikeTitle()+'" />'},saveText=function(a,d,b){$.ajax({type:"POST",
url:"services/save/"+encodeURIComponent(list)+"/"+a+"/"+b+"/"+encodeURIComponent(getHashVar(3)),data:{text:d},dataType:"json",success:function(c){moveListItemToTop(list);localStorage.removeItem(loadKey);null===a?($("#wt-list-item-0").after('<div id="wt-list-item-'+c.id+'" class="wt-list-item" data-id="'+c.id+'"><p class="wt-list-item-text">'+buildDoneCheckbox(c.id)+" "+buildStrikeCheckbox(c.id)+' <span id="wt-text-'+c.id+'" class="wt-text" data-id="'+c.id+'">'+escapeHtml(d)+"</span></p></div>"),useWebSockets&&
conn.send(JSON.stringify({a:"message",actiontype:"add",list:list,text:d,id:c.id})),applyEditItem(c.id),applyRemoveItem(c.id),applyStrikeItem(c.id),applySaveTextOfItem(c.id),applySaveOnEnter(c.id),applyTooltip()):useWebSockets&&conn.send(JSON.stringify({a:"message",actiontype:"save",list:list,text:d,id:c.id}))}})},addStrikeHeader=function(a){a&&0<$(".wt-strikes-header").size()&&$(".wt-strikes-header").remove();0<$(".wt-strike").size()?0===$(".wt-strikes-header").size()&&$(".wt-strike:first").parent().parent().before('<h1 class="wt-strikes-header">These items are marked done</h1>'):
0<$(".wt-strikes-header").size()&&$(".wt-strikes-header").remove()},editing=!1,applyEditItem=function(a){$(".wt-text a").on("click",function(){console.log("Clicked a link");if(!a)var a=window.event;a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation()});$("#wt-text-"+a).on("click",function(){editing=!0;var a=$(this).data("id"),b=$("#wt-text-"+a).text();$("#wt-list-item-"+a).html('<input class="wt-list-item-input" type="text" id="wt-list-item-input-'+a+'" data-id="'+a+'" placeholder="Enter new item here" />');
$("#wt-list-item-input-"+a).val(b);$("#wt-list-item-input-"+a).focus();applySaveTextOfItem(a);applySaveOnEnter(a);applyTooltip()})},applyRemoveItem=function(a){$("#wt-list-item-chk-done-"+a).on("click",function(){if(confirm("Confirm delete please")){var a=$(this).data("id");$.getJSON("services/delete/"+a+"/"+encodeURIComponent(getHashVar(3)),function(b){moveListItemToTop(list);localStorage.removeItem(loadKey);$("#wt-list-item-"+a).remove();addStrikeHeader();useWebSockets&&conn.send(JSON.stringify({a:"message",
actiontype:"remove",list:list,id:a}))})}})},applyStrikeItem=function(a){$("#wt-list-item-chk-strike-"+a).on("click",function(){var a=$(this).data("id"),b=$("#wt-text-"+a),c=!1;b.hasClass("wt-strike")||(c=!0);$("#wt-list-item-chk-strike-"+a);c?b.addClass("wt-strike"):b.removeClass("wt-strike");$.getJSON("services/strike/"+a+"/"+c+"/"+encodeURIComponent(getHashVar(3)),function(b){moveListItemToTop(list);localStorage.removeItem(loadKey);b=$("#wt-list-item-"+a);c?$(".wt-list-item:last").after(b):0<$(".wt-strike").size()&&
$(".wt-strike:first").parent().parent().before(b);addStrikeHeader(!0);useWebSockets&&conn.send(JSON.stringify({a:"message",actiontype:"strike",list:list,strike:c,id:a}))}).fail(function(){c?b.removeClass("wt-strike"):b.addClass("wt-strike")})})},applySaveTextOfItem=function(a){prevtime=parseInt((new Date).getTime());curval="";t=null;$(document).on("keyup","#wt-list-item-input-"+a,function(){var a=$(this).data("id");if(0!==a&&(curtime=parseInt((new Date).getTime()),next=prevtime+500,prevtime=curtime,
curtime<next)){clearTimeout(t);var b=$("#wt-list-item-input-"+a).val(),b=b.replace(/'/,"\\'");t=setTimeout("saveText('"+a+"', '"+b+"', 'false')",500)}})},doApplySaveOnEnter=function(a,d){if(editing||$("#wt-list-item-input-0").is(":focus")){editing=!1;d.preventDefault();var b=a.data("id"),c=$("#wt-list-item-input-"+b).val();0===b?saveText(null,c,!0):($("#wt-list-item-"+b).html('<p class="wt-list-item-text">'+buildDoneCheckbox(b)+" "+buildStrikeCheckbox(b)+' <span id="wt-text-'+b+'" class="wt-text" data-id="'+
b+'">'+escapeHtml(c)+"</span></p>"),applyEditItem(b),applyRemoveItem(b),applyStrikeItem(b),applySaveTextOfItem(b),applySaveOnEnter(b),applyTooltip(),saveText(b,c,!0));a.val("")}},applySaveOnEnter=function(a){$("#wt-list-item-input-"+a).keypress(function(a){var b=$(this);b.on("blur",function(){doApplySaveOnEnter(b,a)});13!==a.which&&27!==a.which||doApplySaveOnEnter(b,a)})},applyAllListClick=function(){$(".wt-all-list-item").on("click",function(){window.location.hash="#/list/"+$(this).data("list")+
"/"+getHashVar(2)})},applyTooltip=function(){/iPhone|iPod|iPad|Android|BlackBerry|phone/i.test(navigator.userAgent)||$(".btn-tooltip").tooltip()},menuToggle=function(){$(".menu-toggle").unbind("click");$(".menu-toggle").on("click",function(a){a.preventDefault();a=$("#wrapper");a.hasClass("toggled")?a.removeClass("toggled"):a.addClass("toggled")})},hideSideBar=function(){$("#wrapper").removeClass("toggled")},setListsLink=function(a){$(".lists-link").attr("href","#/lists/"+encodeURIComponent(a))},init=
function(){var a=window.location.hash,a=a.replace(/^#/,""),a=a.split("/");startConnection();switch(a[1]){case "list":list=a[2];loadKey="list-"+list;load(list);seedSideBar(a[3]);setListsLink(a[3]);setPlaceholder(list);break;case "lists":loadAll();seedSideBar(a[2]);setListsLink(a[2]);break;default:window.location.hash="#/list/inbox/"+a[1]}menuToggle()},isUndefined=function(a){return void 0===a},getHashVar=function(a){return window.location.hash.replace(/^#/,"").split("/")[a]},loadAll=function(){$("#wt-list-item-0").hide();
$(".wt-list-item").remove();$("title").text("all lists");$.getJSON("services/load-all/"+encodeURIComponent(getHashVar(2)),function(a){var d=$(a.items).size(),b=Math.floor(d/4),c=d-3*b,e=$(".wt-list");4<=d?(e.append("<div class='row'><div class='col-sm-12 col-md-6 col-lg-3' id='list-col-1'></div><div class='col-sm-12 col-md-6 col-lg-3' id='list-col-2'></div><div class='col-sm-12 col-md-6 col-lg-3' id='list-col-3'></div><div class='col-sm-12 col-md-6 col-lg-3' id='list-col-4'></div></div>"),$.each(a.items,
function(a,d){var e=a+1;(e<=c?$("#list-col-1"):e>c&&e<=c+1*b?$("#list-col-2"):e>c+1*b&&e<=c+2*b?$("#list-col-3"):$("#list-col-4")).append('<div class="wt-all-list-item" data-list="'+escapeHtml(d)+'"><a title="#'+escapeHtml(d)+'" href="#/list/'+escapeHtml(d)+"/"+getHashVar(2)+'">#'+escapeHtml(d)+"</a></div>")}),e.append("</div>")):(e.append("<div class='row'><div class='columns small-12 medium-12 large-12' id='list-col-1'></div></div>"),$.each(a.items,function(a,b){$("#list-col-1").append('<div class="wt-all-list-item" data-list="'+
escapeHtml(b)+'"><a title="#'+escapeHtml(b)+'" href="#/list/'+escapeHtml(b)+"/"+getHashVar(2)+'">#'+escapeHtml(b)+"</a></div>")}));applyAllListClick();addStrikeHeader()})},seedSideBar=function(a){$.getJSON("services/load-all/"+encodeURIComponent(a),function(d){$.each(d.items,function(b,c){$(".sidebar-nav").append('<li><div class="wt-all-list-item" data-list="'+escapeHtml(c)+'"><a title="#'+escapeHtml(c)+'" href="#/list/'+escapeHtml(c)+"/"+encodeURIComponent(a)+'">#'+escapeHtml(c)+"</a></div></li>")})});
hideSideBar()},escapeDoubleQuotes=function(a){return void 0===a||null===a?a:a.replace(/"/,'\\"')},buildPlaceholder=function(a){return"Add to #"+a},setPlaceholder=function(a){$("#wt-list-item-input-0").attr("placeholder",escapeDoubleQuotes(buildPlaceholder(a)))},load=function(a){$("#wt-list-item-0").show();$(".wt-list-item").remove();$(".wt-all-list-item").remove();$("title").text("#"+a);var d="list-"+a;if(null!=localStorage.getItem(d)){var b=JSON.parse(localStorage.getItem(d));addListItem(b.items);
addStrikeHeader(!0)}else $.getJSON("services/load/"+encodeURIComponent(a)+"/"+encodeURIComponent(getHashVar(3)),function(b){null==localStorage.getItem(d)&&localStorage.setItem(d,JSON.stringify(b));addListItem(b.items);addStrikeHeader(!0);setPlaceholder(a)}).fail(function(){if(null!=localStorage.getItem(d)){var a=JSON.parse(localStorage.getItem(d));addListItem(a.items);addStrikeHeader(!0)}})},search=function(a){$(".wt-list-item").remove();$.getJSON("services/search/"+encodeURIComponent(a)+"/"+encodeURIComponent(getHashVar(3)),
function(a){addListItem(a.items)})},addListItem=function(a){var d=0;$.each(a,function(a,c){var e=c.id,f=c.text;0===a&&(d=0);var g=c.strike?"wt-strike":"";$("#wt-list-item-"+d).after('<div id="wt-list-item-'+e+'" class="wt-list-item" data-id="'+e+'"><p class="wt-list-item-text">'+buildDoneCheckbox(e)+" "+buildStrikeCheckbox(e)+' <span id="wt-text-'+e+'" class="wt-text '+g+'" data-id="'+e+'">'+escapeHtml(f)+'</span> <span class="timestamp">'+c.timestamp+"</span></p></div>");applyEditItem(e);applyRemoveItem(e);
applyStrikeItem(e);applyTooltip();d=e})},sortByPriority=function(){},handleMessage=function(a){a=JSON.parse(a);if("message"===a.a&&a.list===list)if("strike"===a.actiontype){var d=$("#wt-text-"+a.id);a.strike?d.addClass("wt-strike"):d.removeClass("wt-strike");$("#wt-list-item-chk-strike-"+a.id).prop("checked",a.strike)}else"remove"===a.actiontype?$("#wt-list-item-"+a.id).remove():"add"===a.actiontype?($("#wt-list-item-0").after('<div id="wt-list-item-'+a.id+'" class="wt-list-item" data-id="'+a.id+
'"><p class="wt-list-item-text">'+buildDoneCheckbox(a.id)+" "+buildStrikeCheckbox(a.id)+' <span id="wt-text-'+a.id+'" class="wt-text" data-id="'+a.id+'">'+a.text+"</span></p></div>"),applyEditItem(a.id),applyRemoveItem(a.id),applyStrikeItem(a.id),applySaveTextOfItem(a.id),applySaveOnEnter(a.id),applyTooltip()):"save"===a.actiontype&&($("#wt-list-item-"+a.id).html('<p class="wt-list-item-text">'+buildDoneCheckbox(a.id)+" "+buildStrikeCheckbox(a.id)+' <span id="wt-text-'+a.id+'" class="wt-text" data-id="'+
a.id+'">'+a.text+"</span></p>"),applyEditItem(a.id),applyRemoveItem(a.id),applyStrikeItem(a.id),applySaveTextOfItem(a.id),applySaveOnEnter(a.id),applyTooltip())},qs=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(location.search);return null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))},startConnection=function(){useWebSockets&&!connected&&(conn=new WebSocket(webSocketUrl),conn.onopen=function(a){connected=!0;reConnecting=!1},conn.onclose=
function(a){connected=!1;reConnecting||reConnect()},conn.onerror=function(a){connected=!1;reConnecting||reConnect()},conn.onmessage=function(a){handleMessage(a.data)})},reConnect=function(){reConnecting=!0;connected||(init(),setTimeout(reConnect,2E3))};
$(document).ready(function(){init();$(window).on("hashchange",function(){init()});$(".wt-list-item-input:first").focus();applySaveTextOfItem(0);applySaveOnEnter(0);hideSideBar();$(".search-button").on("click",function(){search($("#q").val())});$("#q").keypress(function(a){$(this);13!==a.which&&27!==a.which||search($("#q").val())})});
